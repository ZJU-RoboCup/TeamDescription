# 小型足球机器人--电路组

## 1. 电路架构

电路负责从软件电脑指令的发出，到机械电机的运转、平挑射的执行，之间的信号传输与处理等部分。主要分为通讯模块、STM32核心控制模块、电机驱动模块、平挑射模块等：

* 1.1 通讯模块

	作为机器人和电脑通信的主要功能模块，其抗干扰性、信号的完整性在比赛中尤为重要。

	由于赛场环境的复杂性，为了保证通讯质量，ZJUNlict通讯采用的频点是2.4GHz ，带宽可达2Mbps的**Nordic nRF24L01P 芯片**模块。同时，也选用了更大增益的发射天线和更为灵敏的接收天线，保证了信号的灵敏性与完整性。


* 1.2 STM32核心控制模块

  核心处理器的功能是信号的处理，包括无线通信的控制，电机PWM调制，以及平射挑射的指令下发等。

  2018年之前，我们的核心控制模块全部采用FPGA，为ALTERA公司生产的**Cyclone III**的一款FPGA处理器，其包含25K逻辑门。2019年，我们参考了TIGERs队伍的电路设计，采用了**ST**公司最新推出的一款处理速度达400MHz的处理器STM32H743，经测试其完全能够满足我们的要求，也是我们在悉尼赛中采用的版本。

  目前我们的机器人存在FPGA版本以及STM32版本两种，新车全部采用STM32版本，烧录采用STLINK，相对于FPGA而言具有更好的可维护性和更低的开发难度。

* 1.3 电机驱动模块

  电机驱动包含4个运动电机和1个吸球电机，ZJUNlict 目前采用**Allegro** 公司的**A3930** 芯片进行驱动信号和霍尔信号的处理，实施BLDC 三相直流无刷电机的驱动。

  由于内部带有逻辑信号处理的能力，就一路电机控制而言，A3930 将输入的1路PWM 信号转换成具有一定逻辑关系的6路PWM 信号，控制相应**IR8313 MOSFET**的开闭，从而驱动电机的运转。同时，A3930 还具备霍尔信号检查、电流检测、安全保护等功能。A3930 减轻了主控芯片直接输出6路PWM 波的压力，同时进一步确保了电机驱动系统的稳定运行。

  ZJUNlict 电机驱动系统驱动电压可达24V，驱动电流上限10A，支持70W电机的正常运转。

* 1.4 平射、挑射模块

	平射、挑射模块在电路中表现为升压板，通过将2个2200uF升到190V左右的高压，经过线圈放电，带动平射、挑射杆的方式，实现机器人的平射、挑射功能。

	ZJUNlict目前采用的是**BOOST升压**方式，将电压升到190V，升压模块在小型里算是非常稳定的了。


## 2. 关键技术

* 2.1 PCB绘制

	电路的维护和创新都离不开队员对于电路板原理的掌握与PCB的绘制与维修，例如使用**AD绘制PCB**等。

* 2.2 代码

	电路FPGA、通讯模块都包含十分重要的代码部分，队员需要**熟练操作FPGA、STM32等芯片**。具体包含**Verilog的掌握,以及Quartus、Keil、NIOS II等软件的使用**。

* 2.3 沟通与扩展

	电路需要粗略了解**机械结构、软件的需求**，从而更好的沟通协作。


## 3. 未来发展

* 3.1升压方式的改进

	BOOST升压方式换为**Flyback升压**，减少升压板元器件，为电路其他部分留下空间等。

* 3.2 传感器的使用

	在机器人上面装备更多、功能性较强的传感器等，比如在机器人正前方装一个摄像头以感知球的位置，在电路板上装一个陀螺仪以更精准的控制车的角度等。

- 3.3 发射机的改进

  现有的发射机采用STM32F4系列，采用百兆网口模式，并且发射机和接收机独立。未来为了提高通信质量和速度，计划在FPGA上开发一个千兆的网口服务器，将发射机与接收机合为一体。另外为了防止出现网络拥堵影响通信质量的情况，计划另外开发一个采用USB3.0通信协议的FPGA发射机，作为备用方案。




